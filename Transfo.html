<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculatrice transfo & câbles BT</title>

  <!-- Liens relatifs pour GitHub Pages -->
  <link rel="icon" type="image/png" href="./calculator.png">
  <link rel="stylesheet" href="./style.css">
  <script src="./menu.js" defer></script>
</head>
<body>
  <div class="wrap">
    <h1>Calculatrice électrique – Courants transfo & nombre de câbles BT (FLEX TRAFO)</h1>

 <!--  <div class="card mb-16"> -->
    <div class="container2">
      <h2>Informations chantier</h2>
      <div class="grid">
  <!--      <div class="row"> -->
        <label>Station
          <input id="adresse" type="text" placeholder="STMT ...">
        </label>
        <label>Localité
          <input id="localite" type="text" placeholder="Ville / Commune">
        </label>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Paramètres</h2>
        <label>Puissance du transformateur (kVA)
          <select id="kva">
            <option>250</option>
            <option>400</option>
            <option>630</option>
            <option selected>1000</option>
            <option>1250</option>
            <option>1600</option>
          </select>
        </label>

        <div class="row mt-10">
          <label>Primaire (kV)
            <input id="vpri" type="number" step="0.1" value="21">
          </label>
          <label>Secondaire (V)
            <input id="vsec" type="number" step="1" value="420">
          </label>
        </div>

        <div class="row mt-10">
          <label> cos φ
            <input id="fp" type="number" step="0.01" min="0.1" max="1" value="0.90">
          </label>
          <label>Facteur de correction
            <input id="factor" type="number" step="0.01" value="0.90">
          </label>
        </div>

        <div class="row mt-10">
          <label>Nombre de phases
            <select id="phases">
              <option value="3" selected>3~ (triphasé)</option>
              <option value="1">1~ (monophasé)</option>
            </select>
          </label>
          <label>Section unipolaire FLEX TRAFO
            <select id="section">
              <option value="240|450" selected>240 mm² (≈ 450 A)</option>
              <option value="300|521">300 mm² (≈ 521 A)</option>
              <option value="custom">Autre… (saisir l'ampacité)</option>
            </select>
          </label>
        </div>

        <div class="row mt-10">
          <label>Ampacité perso (A)
            <input id="ampCustom" type="number" step="1" placeholder="ex: 600" disabled>
          </label>
        </div>

        <div class="mt-12">
          <button id="calc">Calculer</button>
        </div>
      </div>

      <div class="card">
        <h2>Résultats</h2>
        <div class="out" id="out">
          <div class="muted">Remplissez les paramètres et cliquez sur « Calculer ».</div>
        </div>
      </div>
    </div>

    <div class="card mt-16">
      <h2>Table rapide (3~ • 420 V • cos φ = 0.90) – ampacité 240 & 300 mm²</h2>
      <table class="table" id="quick"></table>
      <div class="muted mt-6">Hypothèses de la table rapide: triphasé 420 V, cos φ 0.90, sans facteur de correction.</div>
    </div>

    <div class="btns">
      <button class="btn-primary" onclick="window.location.href='./index.html'">Retour à l'accueil</button>
      <button class="btn-secondary" onclick="window.print()">Imprimer</button>
    </div>
  </div>

  <script>
  (function(){
    const fmt = new Intl.NumberFormat('fr-CH', {maximumFractionDigits:2});
    const el = id=>document.getElementById(id);
    const kva = el('kva'), vpri=el('vpri'), vsec=el('vsec');
    const section=el('section'), ampCustom=el('ampCustom'), factor=el('factor');
    const phases=el('phases'), fpEl = el('fp');
    const out=el('out');
    const adresse=el('adresse'), localite=el('localite');

    section.addEventListener('change', ()=>{
      if(section.value==='custom'){ ampCustom.disabled=false; ampCustom.focus(); }
      else { ampCustom.disabled=true; ampCustom.value=''; }
    });

    function iPhase(SkVA, U, ph, fp){
      const cosphi = Math.max(0.1, Math.min(1, fp || 0.9));
      const P = SkVA * 1000 * cosphi;
      return ph==3 ? P / (Math.sqrt(3)*U) : P / U;
    }

    function ampsFromSection(){
      if(section.value==='custom'){
        const a = parseFloat(ampCustom.value);
        return isFinite(a) && a>0 ? a : NaN;
      }
      return parseFloat(section.value.split('|')[1]);
    }

    function protectionTGBT(Isec){
      if (Isec <= 630) return '1 réglette DIN3 630A';
      if (Isec <= 1260) return '1 réglette double DIN3 2x630A';
      if (Isec <= 1600) return 'Disjoncteur 1600A';
      if (Isec <= 2500) return 'Disjoncteur 2500A';
      return 'Protection à définir (hors plage)';
    }

    function calc(){
      const SkVA = parseFloat(kva.value);
      const Upri = parseFloat(vpri.value)*1000;
      const Usec = parseFloat(vsec.value);
      const ph = parseInt(phases.value,10);
      const Asection = ampsFromSection();
      const k = parseFloat(factor.value);
      const fp = parseFloat(fpEl.value);

      if(!SkVA || !Usec || !Upri || !ph || !Asection || !k || !fp){
        out.innerHTML = '<span class="bad">Merci de compléter correctement tous les champs.</span>';
        return;
      }

      const Ipri = iPhase(SkVA, Upri, ph, fp);
      const Isec = iPhase(SkVA, Usec, ph, fp);

      const Aperm = Asection * k;
      const nPerPhase = Math.max(1, Math.ceil(Isec / Aperm));
      const nNeutre = nPerPhase;
      const totalCables = (nPerPhase * (ph===3?3:1)) + (ph===3 ? nNeutre : 0);

      const protection = protectionTGBT(Isec);

      out.innerHTML = `
        <p>Adresse : ${adresse.value || '-'}, ${localite.value || '-'}</p>
        <p>cos φ utilisé : ${fmt.format(fp)}</p>
        <p>Courant primaire : ${fmt.format(Ipri)} A</p>
        <p>Courant secondaire : ${fmt.format(Isec)} A</p>
        <p>Nombre de câbles par phase : ${nPerPhase} + neutre (${nNeutre}) → Total : ${totalCables}</p>
        <p>Protection TGBT : ${protection}</p>
      `;
    }

    el('calc').addEventListener('click', calc);

    const quick = el('quick');
    const ratings = [250,400,630,1000,1250,1600];
    function buildQuick(){
      const U=420, ph=3, cosphi=0.90, pairs=[[240,450],[300,521]];
      let html = '<tr><th>kVA</th><th>Iₛₑc (A)</th>';
      pairs.forEach(p=> html += `<th>${p[0]} mm²</th>`);
      html += '</tr>';
      ratings.forEach(S=>{
        const I = iPhase(S,U,ph,cosphi);
        html += `<tr><td>${S}</td><td>${fmt.format(I)}</td>`;
        pairs.forEach(p=>{
          const n = Math.max(1, Math.ceil(I / p[1]));
          html += `<td>${n} + neutre (${n})</td>`;
        });
        html += '</tr>';
      });
      quick.innerHTML = html;
    }
    buildQuick();
  })();
  </script>
</body>
</html>
