<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ICC en chaîne — Mise en page verticale</title>
<style>
  :root{
    --bg:#0f1222; --panel:#151936; --ink:#e7e9ff; --muted:#9aa3c7; --line:#2a2f57; --accent:#6aa5ff; --ok:#27c28a;
    --r:18px;
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.45 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  header{padding:28px 22px 6px;max-width:980px;margin:auto}
  h1{margin:0 0 8px;font-size:24px}
  p.note{margin:0;color:var(--muted)}
  /* Layout colonne + ligne verticale */
  .stack{position:relative;max-width:980px;margin:18px auto 48px;padding:0 22px}
  .stack:before{
    content:""; position:absolute; left:50%; top:0; transform:translateX(-50%);
    width:4px; height:100%; background:linear-gradient(180deg,var(--line),transparent 12px) repeat-y;
    background-size:4px 24px; border-radius:4px; opacity:.8
  }
  .stage{
    position:relative; display:grid; grid-template-columns: 1fr minmax(320px,560px) 1fr; gap:16px; margin:34px 0;
  }
  .stage .node{
    grid-column:2; background:var(--panel); border:1px solid #1e2450; border-radius:var(--r);
    box-shadow:0 12px 32px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
    padding:16px;
  }
  .dot{position:absolute; left:50%; transform:translate(-50%,-10px); top:-6px; width:18px;height:18px;border-radius:50%;
    background:radial-gradient(circle at 35% 35%, #fff 0 2px, #9dc1ff 3px, #4b78ff 8px, #2746a8 12px);
    box-shadow:0 0 22px #6aa5ffaa, inset 0 0 6px #fff3
  }
  .title{font-weight:700;margin:0 0 8px;font-size:16px}
  .sub{color:var(--muted);font-size:12px;margin:0 0 8px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:640px){ .grid{grid-template-columns:1fr} }
  label{font-size:12px;color:var(--muted)}
  input,select{
    width:100%; background:#0e1330; color:var(--ink); border:1px solid #2a3166; border-radius:12px; padding:10px 12px;
    outline:none;
  }
  input:focus,select:focus{border-color:#3f6bff; box-shadow:0 0 0 3px rgba(106,165,255,.18)}
  .row{display:flex;flex-direction:column;gap:6px}
  .radio{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
  .radio label{display:flex;gap:6px;align-items:center}
  .actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
  button{
    cursor:pointer; border:0; border-radius:12px; padding:10px 14px; font-weight:700;
    background:linear-gradient(180deg,#79b2ff,#3b78ff); color:#071237;
  }
  .ghost{background:#1b234b;color:#b9c3ea;border:1px solid #2d3772}
  .result{
    margin-top:10px; padding:10px 12px; border-radius:12px; background:#0d2c25; color:#7dffd8; font-weight:700
  }
  .hint{color:var(--muted);font-size:12px;margin-top:6px}
  footer{max-width:980px;margin:0 auto 36px;padding:0 22px;color:var(--muted)}
  .tag{display:inline-block;padding:2px 8px;border:1px solid #2d3772;border-radius:999px;font-size:11px;color:#c7cff3}
</style>
</head>
<body>
  <header>
    <h1>Calcul des courants de court-circuit (Ik3ϕ) — Chaîne verticale</h1>
    <p class="note">Modèle de Thévenin. Ik = ULL / (√3 · |Zeq|). Entrer le transfo dans la Station, puis définir chaque tronçon. Les résultats sont en kA.</p>
  </header>

  <main class="stack">
    <!-- Station -->
    <section class="stage" id="st_station">
      <span class="dot"></span>
      <div class="node">
        <p class="title">Station</p>
        <p class="sub">Définition du transformateur et du point de départ</p>
        <div class="grid">
          <div class="row">
            <label>Tension secondaire ULL (V)</label>
            <input type="number" id="st_u" value="400" min="100" step="1">
          </div>
          <div class="row">
            <label>Puissance transfo S (kVA)</label>
            <input type="number" id="st_s" value="630" min="1" step="1">
          </div>
          <div class="row">
            <label>Tension de court-circuit uₖ (%)</label>
            <input type="number" id="st_uk" value="4" min="1" step="0.1">
          </div>
          <div class="row">
            <label>ICC amont connu (kA) optionnel</label>
            <input type="number" id="st_ik_known" placeholder="laisser vide si calcul via transfo" min="0" step="0.01">
          </div>
        </div>
        <div class="actions">
          <button onclick="computeStation()">Initialiser la source</button>
          <button class="ghost" onclick="resetStation()">Réinitialiser</button>
          <span class="tag" id="tag_source">Zeq source: —</span>
        </div>
        <div class="result" id="st_res">Réponse: —</div>
        <div class="hint">Si « ICC amont » est rempli, il est prioritaire sur S/uₖ. Sinon le calcul utilise le transformateur.</div>
      </div>
    </section>

    <!-- Armoire 1 -->
    <section class="stage" id="st_a1">
      <span class="dot"></span>
      <div class="node">
        <p class="title">Armoire 1</p>
        <div class="grid">
          <div class="row">
            <label>Longueur du tronçon (m)</label>
            <input type="number" id="a1_L" min="0" step="0.1" placeholder="ex. 25">
          </div>
          <div class="row">
            <label>Nombre de conducteurs par phase</label>
            <select id="a1_n"><option>1</option><option>2</option><option>3</option><option>4</option></select>
          </div>
          <div class="row">
            <label>Matériau</label>
            <select id="a1_mat"><option value="cu">Cuivre</option><option value="al">Aluminium</option></select>
          </div>
          <div class="row">
            <label>Section (mm²)</label>
            <select id="a1_sec"></select>
          </div>
          <div class="row" style="grid-column:1/-1">
            <label>Pose des conducteurs</label>
            <div class="radio">
              <label><input type="radio" name="a1_pose" value="jointifs" checked>Jointifs</label>
              <label><input type="radio" name="a1_pose" value="espace">Espacés</label>
            </div>
          </div>
        </div>
        <div class="actions">
          <button onclick="calcStage('a1')">Calculer Armoire 1</button>
          <button class="ghost" onclick="resetStage('a1')">Réinitialiser</button>
        </div>
        <div class="result" id="a1_res">Réponse: —</div>
      </div>
    </section>

    <!-- Armoire 2 -->
    <section class="stage" id="st_a2">
      <span class="dot"></span>
      <div class="node">
        <p class="title">Armoire 2</p>
        <div class="grid">
          <div class="row">
            <label>Longueur du tronçon (m)</label>
            <input type="number" id="a2_L" min="0" step="0.1" placeholder="ex. 40">
          </div>
          <div class="row">
            <label>Nombre de conducteurs par phase</label>
            <select id="a2_n"><option>1</option><option>2</option><option>3</option><option>4</option></select>
          </div>
          <div class="row">
            <label>Matériau</label>
            <select id="a2_mat"><option value="cu">Cuivre</option><option value="al">Aluminium</option></select>
          </div>
          <div class="row">
            <label>Section (mm²)</label>
            <select id="a2_sec"></select>
          </div>
          <div class="row" style="grid-column:1/-1">
            <label>Pose des conducteurs</label>
            <div class="radio">
              <label><input type="radio" name="a2_pose" value="jointifs" checked>Jointifs</label>
              <label><input type="radio" name="a2_pose" value="espace">Espacés</label>
            </div>
          </div>
        </div>
        <div class="actions">
          <button onclick="calcStage('a2')">Calculer Armoire 2</button>
          <button class="ghost" onclick="resetStage('a2')">Réinitialiser</button>
        </div>
        <div class="result" id="a2_res">Réponse: —</div>
      </div>
    </section>

    <!-- Client -->
    <section class="stage" id="st_client">
      <span class="dot"></span>
      <div class="node">
        <p class="title">Client</p>
        <div class="grid">
          <div class="row">
            <label>Longueur du tronçon (m)</label>
            <input type="number" id="client_L" min="0" step="0.1" placeholder="ex. 60">
          </div>
          <div class="row">
            <label>Nombre de conducteurs par phase</label>
            <select id="client_n"><option>1</option><option>2</option><option>3</option><option>4</option></select>
          </div>
          <div class="row">
            <label>Matériau</label>
            <select id="client_mat"><option value="cu">Cuivre</option><option value="al">Aluminium</option></select>
          </div>
          <div class="row">
            <label>Section (mm²)</label>
            <select id="client_sec"></select>
          </div>
          <div class="row" style="grid-column:1/-1">
            <label>Pose des conducteurs</label>
            <div class="radio">
              <label><input type="radio" name="client_pose" value="jointifs" checked>Jointifs</label>
              <label><input type="radio" name="client_pose" value="espace">Espacés</label>
            </div>
          </div>
        </div>
        <div class="actions">
          <button onclick="calcStage('client')">Calculer Client</button>
          <button class="ghost" onclick="resetStage('client')">Réinitialiser</button>
        </div>
        <div class="result" id="client_res">Réponse: —</div>
      </div>
    </section>
  </main>

  <footer>
    Astuce: clique d’abord sur « Initialiser la source » pour établir l’impédance équivalente de la Station, puis calcule chaque étape de haut en bas.
  </footer>

<script>
/* Données d'impédances typiques Ω/km à 50 Hz */
const sections = [16,25,35,50,70,95,120,150,185,240,300];
const cable = {
  cu:{ R:{16:1.15,25:0.727,35:0.524,50:0.387,70:0.268,95:0.193,120:0.153,150:0.125,185:0.0991,240:0.0754,300:0.0601}, X:0.08 },
  al:{ R:{16:1.91,25:1.200,35:0.862,50:0.641,70:0.443,95:0.320,120:0.253,150:0.206,185:0.164,240:0.125,300:0.100},  X:0.085 }
};
const poseFactor={jointifs:1.0, espace:1.25};
const sqrt3=Math.sqrt(3);

['a1','a2','client'].forEach(id=>{
  document.getElementById(id+'_sec').innerHTML = sections.map(s=>`<option value="${s}">${s}</option>`).join('');
});

/* Etat courant de la chaîne */
let ULL=400;           // V
let Zsource=0;         // ohms à la station
let Zprop=0;           // ohms propagés jusqu’au dernier noeud

function zFromIk(ull, ik_kA){ return (ik_kA>0) ? ull/(sqrt3*(ik_kA*1000)) : 0; }
function ikFromZ(ull, z){ return (z>0) ? (ull/(sqrt3*z))/1000 : 0; }
function ikTransfo(ull, s_kVA, uk_pct){
  if(!ull||!s_kVA||!uk_pct) return 0;
  const In=(s_kVA*1000)/(sqrt3*ull);
  return (In/(uk_pct/100))/1000; // kA
}
function zCable(mat, sec, L_m, nPar, pose){
  if(!L_m) return 0;
  const Rkm=cable[mat].R[sec]; const Xkm=cable[mat].X*poseFactor[pose];
  const L=L_m/1000; const n=nPar||1;
  return Math.hypot((Rkm*L)/n,(Xkm*L)/n);
}

/* Station */
function computeStation(){
  ULL = Number(document.getElementById('st_u').value||400);
  const S   = Number(document.getElementById('st_s').value||0);
  const uk  = Number(document.getElementById('st_uk').value||6);
  const ikKnown = Number(document.getElementById('st_ik_known').value||0);

  const ik = ikKnown>0 ? ikKnown : ikTransfo(ULL,S,uk);
  Zsource = zFromIk(ULL, ik);
  Zprop = Zsource;

  document.getElementById('st_res').textContent =
    ik>0 ? `Réponse: Ik3ϕ à la Station ≈ ${ik.toFixed(2)} kA` : `Réponse: —`;
  document.getElementById('tag_source').textContent =
    Zsource>0 ? `Zeq source: ${Zsource.toFixed(4)} Ω` : 'Zeq source: —';
  // Réinitialise les résultats aval pour éviter les confusions
  ['a1_res','a2_res','client_res'].forEach(id=>document.getElementById(id).textContent='Réponse: —');
}

function resetStation(){
  document.getElementById('st_u').value=400;
  document.getElementById('st_s').value=630;
  document.getElementById('st_uk').value=6;
  document.getElementById('st_ik_known').value='';
  Zsource=0; Zprop=0;
  document.getElementById('st_res').textContent='Réponse: —';
  document.getElementById('tag_source').textContent='Zeq source: —';
  ['a1_res','a2_res','client_res'].forEach(id=>document.getElementById(id).textContent='Réponse: —');
}

/* Étapes aval */
function calcStage(prefix){
  if(!(Zprop>0)){ alert('Commence par initialiser la Station.'); return; }
  const L   = Number(document.getElementById(prefix+'_L').value||0);
  const n   = Number(document.getElementById(prefix+'_n').value||1);
  const mat = document.getElementById(prefix+'_mat').value;
  const sec = Number(document.getElementById(prefix+'_sec').value||95);
  const pose = [...document.querySelectorAll(`input[name="${prefix}_pose"]`)]
                .find(r=>r.checked)?.value || 'jointifs';

  const Zc = zCable(mat,sec,L,n,pose);
  Zprop = Zprop + Zc;
  const ik = ikFromZ(ULL, Zprop);
  document.getElementById(prefix+'_res').textContent =
    (ik>0) ? `Réponse: Ik3ϕ ≈ ${ik.toFixed(2)} kA (Zeq=${Zprop.toFixed(4)} Ω)` : 'Réponse: —';
}

function resetStage(prefix){
  document.getElementById(prefix+'_L').value='';
  document.getElementById(prefix+'_n').value='1';
  document.getElementById(prefix+'_mat').value='cu';
  document.getElementById(prefix+'_sec').value='95';
  document.querySelectorAll(`input[name="${prefix}_pose"]`)[0].checked=true;
  document.getElementById(prefix+'_res').textContent='Réponse: —';
  // Ne pas toucher à Zprop pour garder la progression de la chaîne
}
</script>
</body>
</html>

