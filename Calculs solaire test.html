<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Outils solaires et choix de câbles</title>

  <!-- Liens relatifs (GitHub Pages) -->
  <link rel="stylesheet" href="./style.css">
  <script src="./menu.js" defer></script>

  <style>
    :root{
      --bg1:#0b1220; --bg2:#12233c;
      --card:#111827; --ink:#e5e7eb; --muted:#94a3b8; --line:#1f2937;
      --field:#0f172a;
      --blue1:#3b82f6; --blue2:#2563eb;
      --green1:#22c55e; --green2:#16a34a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      color:var(--ink);
      background:linear-gradient(120deg,var(--bg1),var(--bg2));
    }
    .wrap{max-width:1200px; margin:24px auto 100px; padding:0 20px}
    h1{text-align:center; margin-bottom:20px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
    .card h2{margin:0 0 6px; font-size:1.05rem}
    .hint{color:var(--muted); font-size:.9rem; margin:0 0 10px}
    .result{margin-top:10px;padding:10px;border:1px dashed #263044;border-radius:12px}
    .fusibles-box{margin-top:30px;padding:16px;background:#0f172a;border:1px solid #2a3449;border-radius:14px}
    .fusibles-box h2{text-align:center;margin:0 0 12px}
    .fusible{margin:8px 0;font-size:1rem}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Outils solaires et choix de câbles</h1>

    <div class="grid">
      <!-- 1) Puissance solaire selon surface du toit -->
      <section class="card">
        <h2>Puissance solaire selon surface du toit</h2>
        <p class="hint">Surface toiture en m² → Puissance disponible.</p>
        <input id="surface" type="number" step="0.01" min="0" placeholder="20">
        <div class="result" id="resSurface">Puissance disponible : —</div>
      </section>

      <!-- 2) Conversion kVA → A -->
      <section class="card">
        <h2>Conversion kVA → A</h2>
        <p class="hint">Triphasé 400 V. I = S / (√3 × U).</p>
        <input id="powerInput" type="number" step="0.01" min="0" placeholder="4">
        <div class="result" id="resConvert">Résultat : — A</div>
      </section>

      <!-- 3) Type de câble selon Imax -->
      <section class="card">
        <h2>Type de câble selon Imax</h2>
        <input id="imaxInput" type="number" step="0.01" min="0" placeholder="5.77">
        <select id="temperatureCable">
          <option value="60">60°C</option>
          <option value="90" selected>90°C</option>
        </select>
        <div class="result" id="resCable">Type de câble : —</div>
      </section>

      <!-- 4) Calculateur de panneaux -->
      <section class="card">
        <h2>Puissance annoncée en [kVA]</h2>
        <p class="hint">Puissance solaire visée en kVA (0.5 kVA par panneau)..</p>
        <input id="panelInput" type="number" step="0.5" min="0.5" placeholder="4">
        <div class="result" id="resPanels">Nombre de panneaux nécessaires : —</div>
      </section>
    </div>

    <!-- Bloc Fusibles -->
    <section class="fusibles-box">
      <h2>Choix des fusibles</h2>
      <div class="fusible" id="fusibleIntro">Fusible coffret introduction : —</div>
      <div class="fusible" id="fusibleGRD">Fusible point de connexion GRD : —</div>
    </section>

    <div class="page-actions">
      <button onclick="location.href='./index.html'">Retour à l'accueil</button>
      <button onclick="window.print()">Imprimer</button>
    </div>
  </main>

  <script>
    const SQRT3 = Math.sqrt(3);
    const U = 400; const REND = 0.1845; const IRR = 1000;
    const PANEL_KVA = 0.5;
    const fmt = new Intl.NumberFormat('fr-CH', { maximumFractionDigits: 2 });

    // Liste normalisée des fusibles
    const fusibles = [6,10,16,20,25,32,40,50,63,80,100,125,160,200,224,250,315,355,400,500,630,800,900,1000,1250];

    const $surface=document.getElementById('surface');
    const $power=document.getElementById('powerInput');
    const $imax=document.getElementById('imaxInput');
    const $panel=document.getElementById('panelInput');
    const $temp=document.getElementById('temperatureCable');

    const $resSurface=document.getElementById('resSurface');
    const $resConvert=document.getElementById('resConvert');
    const $resCable=document.getElementById('resCable');
    const $resPanels=document.getElementById('resPanels');

    const $fusibleIntro=document.getElementById('fusibleIntro');
    const $fusibleGRD=document.getElementById('fusibleGRD');

    const cables={90:[{current:100,cable:"16 mm²"},{current:135,cable:"25 mm²"},{current:195,cable:"50 mm²"}]};

    let lastKva=null;

    function nextFusible(value){
      return fusibles.find(f=>f>=value) || fusibles[fusibles.length-1];
    }

    function applyFromKva(kva,source){
      if(!isFinite(kva)||kva<=0){$resSurface.textContent="Puissance disponible : —";return;}
      lastKva=kva;
      const I=(kva*1000)/(SQRT3*U);
      $resSurface.textContent="Puissance disponible : "+fmt.format(kva)+" kVA";
      $resConvert.textContent="Résultat : "+fmt.format(I)+" A";
      $resPanels.textContent="Nombre de panneaux nécessaires : "+Math.ceil(kva/PANEL_KVA);

      // Cable
      const found=cables[90].find(c=>I<=c.current);
      $resCable.textContent="Type de câble : "+(found?found.cable:"—");

      // Fusibles
      const fIntro=nextFusible(I);
      const fGRD=nextFusible(fIntro+0.1);
      $fusibleIntro.textContent="Fusible coffret introduction : "+fIntro+" A";
      $fusibleGRD.textContent="Fusible point de connexion GRD : "+fGRD+" A";
    }

    $power.addEventListener("input",()=>applyFromKva(parseFloat($power.value)));
    $imax.addEventListener("input",()=>{const I=parseFloat($imax.value);if(I>0){applyFromKva((I*SQRT3*U)/1000)}});
    $surface.addEventListener("input",()=>{const s=parseFloat($surface.value);if(s>0){applyFromKva((s*REND*IRR)/1000)}});
    $panel.addEventListener("input",()=>{const kva=parseFloat($panel.value);if(kva>0){applyFromKva(kva)}});
  </script>
</body>
</html>
