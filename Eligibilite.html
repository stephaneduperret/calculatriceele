<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Éligibilité RCP — Consommation / Production</title>

        <!-- Liens relatifs (GitHub Pages) -->
 <!-- <link rel="stylesheet" href="./style.css"> -->
  <script src="./menu.js" defer></script>
  
<style>
  :root{
    --bg:#f4f6fa; --ink:#0f172a;
    --header:#e2e8f0; --band:#cbd5e1;
    --line:#94a3b8; --ok:#16a34a; --bad:#ef4444; --pct:#0ea5e9;
    --r:10px;
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.5 system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:920px;margin:30px auto;padding:0 16px}
  h1{font-size:20px;margin:0 0 10px}
  .toolbar{display:flex;gap:8px;margin:8px 0 14px}
  button{
    border:1px solid var(--line); background:#fff; padding:8px 10px; border-radius:10px; cursor:pointer;
  }
  button:hover{filter:brightness(0.98)}
  table{width:100%; border-collapse:separate; border-spacing:0; background:#fff; border:1px solid var(--line); border-radius:var(--r); overflow:hidden}
  thead th{background:var(--header); text-align:left; padding:10px 12px; border-bottom:1px solid var(--line)}
  tbody td, tfoot td{padding:8px 12px; border-bottom:1px solid #e5e7eb}
  tbody tr:last-child td{border-bottom:none}
  tbody td.addr{background:var(--band)}
  tfoot td{background:var(--header); font-weight:600}
  input[type="text"]{width:100%; border:1px solid #d1d5db; border-radius:8px; padding:8px 10px}
  input[type="number"]{width:120px; text-align:right; border:1px solid #d1d5db; border-radius:8px; padding:8px 10px}
  .cons{color:var(--bad); font-variant-numeric:tabular-nums}
  .prod{color:var(--ok);  font-variant-numeric:tabular-nums}
  .pct {color:var(--pct); font-variant-numeric:tabular-nums; text-align:right}
  .right{text-align:right}
  .row-actions{width:70px}
  .hint{margin:8px 0 0; color:#64748b; font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Éligibilité Regroupement — Bilan annuel</h1>

  <div class="toolbar">
    <button id="addRow">Ajouter une adresse</button>
    <button id="clearAll">Tout effacer</button>
  </div>

  <table id="tbl">
    <thead>
      <tr>
        <th>Adresse</th>
        <th>Consommation [kWh/an]</th>
        <th>Refoulement de la Production [kWh/an]</th>
        <th class="right">%</th>
        <th class="row-actions">Actions</th>
      </tr>
    </thead>
    <tbody id="body">
      <!-- Lignes dynamiques -->
    </tbody>
    <tfoot>
      <tr>
        <td class="right">Total :</td>
        <td class="right cons" id="totCons">0</td>
        <td class="right prod" id="totProd">0</td>
        <td class="pct" id="totPct">0.00</td>
        <td></td>
      </tr>
    </tfoot>
  </table>

  <p class="hint">Le pourcentage est calculé ainsi : Production totale ÷ Consommation totale × 100. Les champs numériques acceptent les virgules ou les points.</p>
</div>

<script>
  const body = document.getElementById('body');
  const addBtn = document.getElementById('addRow');
  const clearBtn = document.getElementById('clearAll');
  const totCons = document.getElementById('totCons');
  const totProd = document.getElementById('totProd');
  const totPct  = document.getElementById('totPct');

  // Formatteurs
  const fmt = new Intl.NumberFormat('fr-CH', { maximumFractionDigits: 0 });
  const fmtPct = new Intl.NumberFormat('fr-CH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

  function toNumber(v){
    // Accepte virgule ou point, espaces comme séparateurs de milliers
    if (typeof v !== 'string') return Number(v) || 0;
    return Number(v.replace(/\s/g,'').replace(',', '.')) || 0;
  }

  function addRow(addr='', cons='', prod=''){
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td class="addr"><input type="text" placeholder="Rue, N°, Localité" value="${addr}"></td>
      <td class="right"><input type="number" step="0.01" min="0" inputmode="decimal" class="cons"></td>
      <td class="right"><input type="number" step="0.01" min="0" inputmode="decimal" class="prod"></td>
      <td class="pct"></td>
      <td class="row-actions"><button class="del">Supprimer</button></td>
    `;
    body.appendChild(tr);

    const iCons = tr.querySelector('input.cons');
    const iProd = tr.querySelector('input.prod');
    iCons.value = cons;
    iProd.value = prod;

    const onInput = () => { updateRowPct(tr); updateTotals(); };
    iCons.addEventListener('input', onInput);
    iProd.addEventListener('input', onInput);

    tr.querySelector('.del').addEventListener('click', () => { tr.remove(); updateTotals(); });

    updateRowPct(tr);
    updateTotals();
  }

  function updateRowPct(tr){
    const c = toNumber(tr.querySelector('input.cons').value);
    const p = toNumber(tr.querySelector('input.prod').value);
    const cell = tr.querySelector('.pct');
    const percent = (c > 0) ? (p / c * 100) : 0;
    cell.textContent = fmtPct.format(percent);
  }

  function updateTotals(){
    let cTot = 0, pTot = 0;
    [...body.querySelectorAll('tr')].forEach(tr => {
      cTot += toNumber(tr.querySelector('input.cons').value);
      pTot += toNumber(tr.querySelector('input.prod').value);
    });
    totCons.textContent = fmt.format(cTot);
    totProd.textContent = fmt.format(pTot);
    const pct = (cTot > 0) ? (pTot / cTot * 100) : 0;
    totPct.textContent = fmtPct.format(pct);
  }

  addBtn.addEventListener('click', () => addRow());
  clearBtn.addEventListener('click', () => { body.innerHTML = ''; updateTotals(); });

  // Exemples init (comme l’image)
  addRow('Vigne 26 – Orbe', '945', '7196');
  addRow('Vigne 28 – Orbe', '8141', '');
</script>
</body>
</html>


