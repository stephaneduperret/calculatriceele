async function searchByNom(term) {
  log.textContent = "Recherche...";
  tbody.innerHTML = "";

  let query = supabase
    .from('contacts')
    .select('id, nom, prenom, email, telephone, message, created_at')
    .order('created_at', { ascending: false })
    .limit(200);

  if (term && term.trim() !== "") {
    const t = term.trim();
    query = query.or(`
      nom.ilike.%${t}%,
      prenom.ilike.%${t}%,
      email.ilike.%${t}%,
      telephone.ilike.%${t}%
    `);
  }

  const { data, error } = await query;

  if (error) {
    log.textContent = "❌ Erreur (recherche) : " + error.message;
    return;
  }
  if (!data || data.length === 0) {
    log.textContent = "Aucun résultat.";
    return;
  }

  for (const r of data) {
    const tr = document.createElement('tr');
    tr.dataset.id = r.id;
    tr.innerHTML = `
      <td>${escapeHtml(r.nom ?? "")}</td>
      <td>${escapeHtml(r.prenom ?? "")}</td>
      <td>${escapeHtml(r.email ?? "")}</td>
      <td>${escapeHtml(r.telephone ?? "")}</td>
      <td>${escapeHtml(r.message ?? "")}</td>
      <td>${new Date(r.created_at).toLocaleString()}</td>
    `;

    tr.addEventListener('click', () => {
      document.querySelectorAll('#results tbody tr.selected').forEach(el => el.classList.remove('selected'));
      tr.classList.add('selected');
      enterEditMode(r);
    });

    tbody.appendChild(tr);
  }

  log.textContent = `✅ ${data.length} résultat(s). Cliquez une ligne pour éditer.`;
}
